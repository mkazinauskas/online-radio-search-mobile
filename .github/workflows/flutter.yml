name: Flutter CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:

    runs-on: ubuntu-latest

    env:
      KEY_JKS: ${{ secrets.KEY_JKS }}
      KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
      STORE_PASSWORD: ${{ secrets.STORE_PASSWORD }}
      KEY_ALIAS: ${{ secrets.KEY_ALIAS }}
    steps:

    - uses: actions/checkout@v2
    - uses: actions/setup-java@v1
      with:
        java-version: '12.x'
    - uses: timheuer/base64-to-file@v1.0.3
      id: write_key_jks
      with:
        fileName: 'signing.jks'
        encodedString: $KEY_JKS
    - uses: subosito/flutter-action@v1.3.2
      with:
        flutter-version: '1.22.0'
    - run: cp ${{ steps.write_key_jks.outputs.filePath }} signing.jks
    - run: ls
    - run: tail -1 signing.jks
    - run: flutter doctor
    - run: flutter pub get
    - run: flutter test
    - run: flutter build apk
